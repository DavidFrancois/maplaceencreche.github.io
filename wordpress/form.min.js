"use strict";jQuery(document).ready(function(){function e(){$("#main-submit > span").html(u),$("#main-submit").attr("disabled",!1)}var a="DD/MM/YYYY",r={previousMonth:"Mois précédent",nextMonth:"Mois suivant",months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],weekdays:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],weekdaysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]};$(".mpec-date").each(function(e,i){new Pikaday({field:i,firstDay:1,format:a,i18n:r})});var i=$('select[name="children_number"]');i.change(function(){if(""!==i.val())for(var e=1;e<=i.val();e++)$("#child"+e).fadeIn(),$("#child"+e+" input").prop("required",!0),$("#child"+(e+1)+", #child"+(e+2)).fadeOut(),$("#child"+(e+1)+" input, #child"+(e+2)+" input").prop("required",!1);else $("#child1, #child2, #child3").fadeOut()});var n=$("#zip"),t=$("#city"),o=t.html();if(n.keyup(function(){n.val().length<5?(n.html(o),$("#parentCity").fadeOut()):($("#parentCity").fadeIn(),$.ajax({url:"https://icare.maplaceencreche.com/api/static/zipcode/"+n.val(),dataType:"json",success:function(e){t.html(o);for(var a in e)t.append('<option value="'+e[a].c+'">'+e[a].c+"</option>")}}))}),null!==localStorage.getItem("MPECData")){var s=JSON.parse(localStorage.getItem("MPECData")).meta;for(var l in s){var c=s[l];$("#meta-inputs").append('<input type="hidden" name="meta_'+l+'" value="'+c+'">')}}$('input[readonly], input[name="you_earning"]').change(function(){$(this).css({borderColor:""})});var u=$("#main-submit > span").html();$("form#family-register").submit(function(a){a.preventDefault();var r=!0,i="input[readonly]";$("#main-submit").attr("disabled",!0),$("#main-submit > span").html("Inscription en cours ..."),$(".error-block").html(""),$(i).each(function(e){switch(parseInt($('select[name="children_number"] option:selected').val())){case 1:2>e&&""===$(i+":eq("+e+")").val()&&($(i+":eq("+e+")").css({borderColor:"#d9534f"}),r=!1);break;case 2:4>e&&""===$(i+":eq("+e+")").val()&&($(i+":eq("+e+")").css({borderColor:"#d9534f"}),r=!1);break;case 3:""===$(i+":eq("+e+")").val()&&($(i+":eq("+e+")").css({borderColor:"#d9534f"}),r=!1)}}),""===t.val()&&(t.is(":visible")?(t.css({borderColor:"#d9534f"}),n.css({borderColor:""})):(n.css({borderColor:"#d9534f"}),t.css({borderColor:""})),r=!1),r||$(".error-block").append("<p>Vous avez des champs obligatoires non remplis.</p>"),(isNaN(parseInt($('input[name="you_earning"]').val()))||parseInt($('input[name="you_earning"]').val())<1)&&($('input[name="you_earning"]').css({borderColor:"#d9534f"}),$(".error-block").append("<p>Vous avez saisi une valeur de revenus non valide.</p>"),r=!1),r?$.ajax({url:"https://icare.maplaceencreche.com/api/input/register",type:"post",dataType:"json",data:$(this).serialize(),success:function(e){localStorage.removeItem("MPECData"),window.location.href="/merci-famille"},error:function(a){$(".error-block").html("Une erreur est survenue lors de l'envoi du formulaire, veuillez réessayer."),e()}}):e()})});
