"use strict";jQuery(document).ready(function(){function e(){$("#main-submit > span").html(l),$("#main-submit").attr("disabled",!1)}var a="DD/MM/YYYY",n={previousMonth:"Mois précédent",nextMonth:"Mois suivant",months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],weekdays:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],weekdaysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]};$(".mpec-date").each(function(e,r){new Pikaday({field:r,firstDay:1,format:a,i18n:n})});var r=$('select[name="children_number"]');r.change(function(){if(""!==r.val())for(var e=1;e<=r.val();e++)$("#child"+e).fadeIn(),$("#child"+e+" input").prop("required",!0),$("#child"+(e+1)+", #child"+(e+2)).fadeOut(),$("#child"+(e+1)+" input, #child"+(e+2)+" input").prop("required",!1);else $("#child1, #child2, #child3").fadeOut()});var i=$("#zip"),t=$("#city");if(i.autocomplete({source:function(e,a){$.ajax({url:"https://icare.maplaceencreche.com/api/static/zipcode/"+e.term,dataType:"json",success:function(e){a($.map(e,function(e){return e.z+", "+e.c}))}})},select:function(e,a){t.val(a.item.value.substring(7))},minLength:3}),i.focusout(function(){var e=$(this).val();$(this).val(e.slice(0,5)),t.css({borderColor:""})}),i.change(function(){i.val().length<4&&t.val("")}),null!==localStorage.getItem("MPECData")){var o=JSON.parse(localStorage.getItem("MPECData")).meta;for(var s in o){var c=o[s];$("#meta-inputs").append('<input type="hidden" name="meta_'+s+'" value="'+c+'">')}}$('input[readonly], input[name="you_earning"]').change(function(){$(this).css({borderColor:""})});var l=$("#main-submit > span").html();$("form#family-register").submit(function(a){a.preventDefault();var n=!0,r="input[readonly]";$("#main-submit").attr("disabled",!0),$("#main-submit > span").html("Inscription en cours ..."),$(".error-block").html(""),$(r).each(function(e){switch(parseInt($('select[name="children_number"] option:selected').val())){case 1:(2>e||e===$("input[readonly]").length-1)&&""===$(r+":eq("+e+")").val()&&($(r+":eq("+e+")").css({borderColor:"#d9534f"}),n=!1);break;case 2:(4>e||e===$("input[readonly]").length-1)&&""===$(r+":eq("+e+")").val()&&($(r+":eq("+e+")").css({borderColor:"#d9534f"}),n=!1);break;case 3:""===$(r+":eq("+e+")").val()&&($(r+":eq("+e+")").css({borderColor:"#d9534f"}),n=!1)}}),n||$(".error-block").append("<p>Vous avez des champs obligatoires non remplis.</p>"),(isNaN(parseInt($('input[name="you_earning"]').val()))||parseInt($('input[name="you_earning"]').val())<1)&&($('input[name="you_earning"]').css({borderColor:"#d9534f"}),$(".error-block").append("<p>Vous avez saisi une valeur de revenus non valide.</p>"),n=!1),n?$.ajax({url:"https://icare.maplaceencreche.com/api/input/register",type:"post",dataType:"json",data:$(this).serialize(),success:function(e){window.location.href="/merci-famille"},error:function(a){$(".error-block").html("Une erreur est survenue lors de l'envoi du formulaire, veuillez réessayer."),e()}}):e()})});