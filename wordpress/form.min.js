"use strict";jQuery(document).ready(function(){function k(){$("#main-submit > span").html(j),$("#main-submit").attr("disabled",!1)}var a="DD/MM/YYYY",b={previousMonth:"Mois précédent",nextMonth:"Mois suivant",months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],weekdays:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],weekdaysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]};$(".mpec-date").each(function(c,d){new Pikaday({field:d,firstDay:1,format:a,i18n:b})});var c=$('select[name="children_number"]');c.change(function(){if(""!==c.val())for(var a=1;a<=c.val();a++)$("#child"+a).fadeIn(),$("#child"+a+" input").prop("required",!0),$("#child"+(a+1)+", #child"+(a+2)).fadeOut(),$("#child"+(a+1)+" input, #child"+(a+2)+" input").prop("required",!1);else $("#child1, #child2, #child3").fadeOut()});var d=$("#zip"),e=$("#city"),f=e.html();if(d.keyup(function(){d.val().length<5?(d.html(f),$("#parentCity").fadeOut()):($("#parentCity").fadeIn(),$.ajax({url:"https://icare.maplaceencreche.com/api/static/zipcode/"+d.val(),dataType:"json",success:function(a){e.html(f);for(var b in a)e.append('<option value="'+a[b].c+'">'+a[b].c+"</option>")}}))}),null!==localStorage.getItem("MPECData")){var g=JSON.parse(localStorage.getItem("MPECData")).meta;for(var h in g){var i=g[h];$("#meta-inputs").append('<input type="hidden" name="meta_'+h+'" value="'+i+'">')}}$('input[readonly], input[name="you_earning"]').change(function(){$(this).css({borderColor:""})});var j=$("#main-submit > span").html();$("form#family-register").submit(function(a){a.preventDefault();var b=!0,c="input[readonly]",f=$('input[name="you_cellphone"]').val().replace(/ /g,""),g=/^[\+0].+/;$("#main-submit").attr("disabled",!0),$("#main-submit > span").html("Inscription en cours ..."),$(".error-block").html(""),$(c).each(function(a){switch(parseInt($('select[name="children_number"] option:selected').val())){case 1:a<2&&""===$(c+":eq("+a+")").val()&&($(c+":eq("+a+")").css({borderColor:"#d9534f"}),b=!1);break;case 2:a<4&&""===$(c+":eq("+a+")").val()&&($(c+":eq("+a+")").css({borderColor:"#d9534f"}),b=!1);break;case 3:""===$(c+":eq("+a+")").val()&&($(c+":eq("+a+")").css({borderColor:"#d9534f"}),b=!1)}}),""===e.val()&&(e.is(":visible")?(e.css({borderColor:"#d9534f"}),d.css({borderColor:""})):(d.css({borderColor:"#d9534f"}),e.css({borderColor:""})),b=!1),b||$(".error-block").append("<p>Vous avez des champs obligatoires non remplis.</p>"),(isNaN(parseInt($('input[name="you_earning"]').val()))||parseInt($('input[name="you_earning"]').val())<1)&&($('input[name="you_earning"]').css({borderColor:"#d9534f"}),$(".error-block").append("<p>Vous avez saisi une valeur de revenus non valide.</p>"),b=!1),(0===parseInt(f)||f.length<10||!g.test(f))&&($('input[name="you_cellphone"]').css({borderColor:"#d9534f"}),$(".error-block").append("<p>Vous avez saisi un numéro de téléphone non valide.</p>"),b=!1),b?$.ajax({url:"https://icare.maplaceencreche.com/api/input/register",type:"post",dataType:"json",data:$(this).serialize(),success:function(a){localStorage.removeItem("MPECData"),window.location.href="/merci-famille"},error:function(a){$(".error-block").html("Une erreur est survenue lors de l'envoi du formulaire, veuillez réessayer."),k()}}):k()})});
